<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Emojiland!</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üç≥</text></svg>">
  <style>
    body { padding: 20px; }
    .emoji-card {
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      margin: 10px;
      text-align: center;
      flex: 0 0 calc(20% - 20px); /* 5 cards per row */
    }
    #emoji-list { display: flex; flex-wrap: wrap; }
  </style>
</head>
<body>
  <h1 class="mb-3">Welcome to Emojiland!</h1>
  <p>Browse and search emojis below.</p>

  <!-- Controls -->
  <div class="row g-2 mb-3">
    <div class="col-12 col-md-4">
      <input type="text" id="search" placeholder="Search by name..." class="form-control" />
    </div>
    <div class="col-12 col-md-3">
      <select id="categoryFilter" class="form-select">
        <option value="">All Categories</option>
      </select>
    </div>
    <div class="col-12 col-md-3">
      <select id="groupFilter" class="form-select">
        <option value="">All Groups</option>
      </select>
    </div>
    <div class="col-12 col-md-2">
      <select id="sortFilter" class="form-select">
        <option value="name">Sort by Name</option>
        <option value="category">Sort by Category</option>
        <option value="group">Sort by Group</option>
      </select>
    </div>
  </div>

  <!-- Emoji grid -->
  <div id="emoji-list"></div>

  <script>
    let emojis = [];

    // Fetch emojis from backend
    fetch('/api/emojis')
      .then(res => res.json())
      .then(data => {
        emojis = data;   // backend returns array directly
        populateCategories();
        populateGroups();
        applyFilters();  // initial render
      });

    const renderEmojis = (list) => {
      const container = document.getElementById('emoji-list');
      container.innerHTML = '';
      list.forEach(e => {
        const div = document.createElement('div');
        div.className = 'emoji-card';
        div.innerHTML = `
          <div style="font-size: 2rem;">${e.htmlCode.join('')}</div>
          <p><strong>${e.name}</strong></p>
          <p>${e.category}</p>
          <small class="text-muted">${e.group}</small>
        `;
        container.appendChild(div);
      });
    };

    const populateCategories = () => {
      const select = document.getElementById('categoryFilter');
      const categories = [...new Set(emojis.map(e => e.category))].sort();
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option);
      });
    };

    const populateGroups = () => {
      const select = document.getElementById('groupFilter');
      const groups = [...new Set(emojis.map(e => e.group))].sort();
      groups.forEach(gr => {
        const option = document.createElement('option');
        option.value = gr;
        option.textContent = gr;
        select.appendChild(option);
      });
    };

    const applyFilters = () => {
      const term = document.getElementById('search').value.toLowerCase();
      const category = document.getElementById('categoryFilter').value;
      const group = document.getElementById('groupFilter').value;
      const sortKey = document.getElementById('sortFilter').value;

      let filtered = emojis.filter(em =>
        (term === '' || em.name.toLowerCase().includes(term)) &&
        (category === '' || em.category === category) &&
        (group === '' || em.group === group)
      );

      // ‚úÖ sort alphabetically by chosen field
      filtered = filtered.sort((a, b) => a[sortKey].localeCompare(b[sortKey]));

      renderEmojis(filtered);
    };

    // Hook up events
    document.getElementById('search').addEventListener('input', applyFilters);
    document.getElementById('categoryFilter').addEventListener('change', applyFilters);
    document.getElementById('groupFilter').addEventListener('change', applyFilters);
    document.getElementById('sortFilter').addEventListener('change', applyFilters);
  </script>
</body>
</html>
